<html>
<head>
<title>2_mzee</title>
<style type="text/css">
<!--
  :link { color: rgb(110, 0, 110); } 
  :visited { color: rgb(110, 0, 110); } 
  body { margin-left: 5px; font-family: arial, sans-serif; 
         background: white; font-size: 12pt } 
  h2 { background: rgb(166,172,255); 
       font-size: 15pt; 
       padding-left: 6px; padding-right: 6px; padding-top: 6px; 
       padding-bottom: 6px; } 
  p { margin-left: 10px; } 
  pre { margin-left: 13px; background: rgb(225,225,225); 
        font-family: monospace; padding-left: 3px; padding-right: 3px; 
        padding-top: 3px; padding-bottom: 3px; } 
-->
</style>
</head>
<body>

<p>This page was automatically generated by NetLogo 4.1.
Questions, problems?  Contact <a href="mailto:feedback@ccl.northwestern.edu">feedback@ccl.northwestern.edu</a>.</p>

<p>The applet requires Java 5 or higher.
Java must be enabled in your browser settings.
Mac users must have Mac OS X 10.4 or higher.
Windows and Linux users may obtain the latest Java from
<a href="http://java.sun.com/getjava/download.html">Sun's Java site</a>.</p>

<p><hr>

<p><font size="-1">In order for this to work, this file, your model file
(2_mzee.nlogo), and the file NetLogoLite.jar
must all be in the same directory.  (You can copy NetLogoLite.jar
from the directory where you installed NetLogo.)</font></p>

<p><font size="-1">On some systems, you can test the applet locally on your computer
before uploading it to a web server.  It doesn't work on all systems,
though, so if it doesn't work from your hard drive, please try
uploading it to a web server.</font></p>

<p><font size="-1">You don't need to include everything in this file in your page.
If you want, you can just take the HTML code beginning with
&lt;applet&gt; and ending with &lt;/applet&gt;, and paste it into any HTML
file you want.  It's even OK to put multiple &lt;applet&gt; tags
on a single page.</font></p>

<p><font size="-1">If NetLogoLite.jar and your model are in different
directories, you must modify the archive= and value= lines
in the HTML code to point to their actual locations.
(For example, if you have multiple applets in different
directories on the same web server, you may want to put 
a single copy of NetLogoLite.jar in one central place and
change the archive= lines of all the HTML files to point
to that one central copy.  This will save disk space for
you and download time for your users.)</font></p>

<p>
<applet code="org.nlogo.lite.Applet"
        archive="NetLogoLite.jar"
        width="1145" height="705">
  <param name="DefaultModel"
         value="2_mzee.nlogo">
</applet>
</p>

<p>powered by
<a target="_blank" href="http://ccl.northwestern.edu/netlogo/">NetLogo</a></p>

<p>view/download model file:
<a href="2_mzee.nlogo">2_mzee.nlogo</a>
</p>
<h2>WHAT IS IT?</h2>
<p>A cellular automata that models adaptive transport. White particles are transported over a green road, which is protected by brown walls. When the particles collide, they will die and a new road is created, perpendicular to the original one. This results in a cross-section. When a different particle reaches this crossing, it will become the flow controller of that crossing.</p>
<p>Flow controllers have a red colour and decide whether particles are allowed to go through. This process is adaptive, which leads to a global state where the number of particles will pulse around a fixed number. The value of this number is in direct relation with the amount of particles that the flow controllers lets through. </p>
<p>This process is visualized in the graph at the bottom of the simulation.</p>
<p>As the simulation continues, the amount of crossings will increase (red line).<br>The amount of particles (blue line) will have a pulsing, (very rough) sinus-like behavior. This is the same for the avarage waiting time (orange line). The average waiting time stands for the avarage time that the flow controllers will wait before they will let through any particles. These two values depend on eachother recursively:</p>
<p>Imagine there are many particles. This means that the avarage waiting time of the flow controllers will increase, since they want to stabilize this amount. Because of this, a lot of particles will die (the flow controllers will not let the particles through). This leads to less particles, which will allow the flow controllers to decrease their waiting time. This will again result in more particles (the flow controller will let through the particles), and the circle is round.</p>
<p>The system can also respond to obstacles. Roads that lead to obstacles will be destroyed, which means that in time, only roads around the obstacle will survive.</p><br>
<h2>HOW IT WORKS</h2>
<p>The simulation consists of the following patches:<br>- Particles (white)<br>- Roads (green)<br>- Flow controllers (red)<br>- Walls (brown)<br>- Obstacles (magenta)</p>
<p>Because this is a cellular automata, every patch can only change itself, but it is able to see its neighbors. Based on the states of his neighbors it is able to make a decision for its own next state.</p>
<p>--- Particles<br>Particles will have a different tint, based on their direction. <br>When a particle reaches an obstacle it will turn pink, else it will simply turn green again.</p>
<p>--- Roads<br>A road patch will look for incoming patches, and for pink colours. If it detects a pink color, it will delete itself. When it is also near a crossing and it detects a pink color, it will become a wall. In this way, roads are only deleted until the crossing.</p>
<p>--- Flow controllers<br>Flow controllers have a default wait value (DWV) and a current waiting value (CWV). The CWV will decrease over time, until it is zero. Every time a particle enters, the crossing will check if the CWV is zero. If it is zero, the crossing will allow the particle to move in every direction on the crossing, the DWV will be decreased and the CWV will be set to the DWV. If the CWV is not zero, the particle will be deleted and the DWV is increased.</p>
<p>This means that the DWV is adjusted to the amount of incoming particles. Every time a particle enters and the CWV is not zero, the DWV will be increased. Therefore, the next time the crossing will have a longer waiting time.</p>
<p>--- Walls<br>The wall patch exists purely for practical purposes. It is an extra protection to make sure that the roads collide properly.</p>
<p>--- Obstacles<br>Obstacles can only be added by the user. they have no properties except that they are magenta coloured and very evil.</p><br>
<h2>HOW TO USE IT</h2>
<p>The GUI consists of roughly four categories:</p>
<p>1. Controlling the simulation<br>Go/go once: start the simulation, forever or for one tick<br>Clear world: make the world completely black<br>Random setup: this will create a random amount of roads, in random places. note that it will not add particles. It might take a while to the simulation to start. There will be several roads but no flow controllers yet. This means that all flow controllers have to be created with a particle first. Therefore it is suggested to enable 'add-particle-when-empty' and wait for a while.</p>
<p>2. Manipulating the simulation<br>Add new particle: add a particle in at a random place in the simulation. Only possible when there is a road.<br>(ON/OFF) Add particle when empty: often (especially at the beginning of the simulation), all the particles will have died. This can be because they all have collided, or have become flow controllers. ith this option, whenever there are zero particles, a new particle will be added automatically and thus the simulation will never stop.</p>
<p>Draw road: the user can click on the simulation and add a roadpiece, this road will be automatically extended.<br>Draw direction: the direction of the road.</p>
<p>Draw obstacle: lets the user draw an obstacle in the simulation.</p>
<p>3. File input/output<br>Five presets have been made, and a population density is suggested for each preset.<br>- Basic: the start of a simulation<br>- Advanced: a simulation that has been running for quite a while.<br>- Periodic: a repeating pattern, also clearly visible in the graph!<br>- Obstacle 1: example of an obstacle that has just been placed in a simulation.<br>- Obstacle 2: an obstacle in the shape of an M, which is of course crazy funny.</p>
<p>Also, the user has the possiblity to save/load custom presets.</p>
<p>4. Graph<br>The output graph, see above for an explanation.</p><br>
<h2>THINGS TO NOTICE</h2>
<p>- I have used different dimensions for the world. it also runs perfectly on the asked sizes (100x60), but a little more slow. I believe that the simulation comes more to its right in the current size. I discussed this with Alexander and he told me that it was not problem as long as i mentioned it. Please notice that the presets will not run on other dimensions.<br>- The particles can only move in straight lines, so they cannot make curves.<br>- Sometimes, regions will be filled with brown and green (especially when starting with a random setup) but this does not affect the simulation. Its simply a result of the interactions.<br>- In rare occassions, an obstacle will lead to total chaos. This is because obstacles are evil and sometimes take-over the simulation.</p><br>
<h2>THINGS TO TRY</h2>
<p>- Start the periodic preset and let it run for a while. Notice the graph.<br>Then add a particle (which will be placed randomly) and see how it affects the simulation. Isn't it remarkable that such a little addition can turn perfect harmony into total chaos?</p>
<p>- Create a new simulation and let it run until there is a good flow. Then try to lower the population density as much as possible without letting it die. At this point, the most interesting patterns emerge.</p>
<p>- Observe the graph for a while when you make changes. It is very interesting to see how the avarage-waiting-time and the amount of particles respond to eachother.</p>
<p>- Notice that every state is totally reproducable! As long as the user doesn't add anything, everything is deterministic.</p><br>
<h2>EXTENDING THE MODEL</h2>
<p>It would be nice of the simulation would also run smooth on the dimension 100x60, but i haven't been able to optimize it any further.</p><br>
<h2>RELATED MODELS</h2>
<p>Brains Brain<br>File Input/Output<br>WireWorld</p><br>
<h2>CREDITS AND REFERENCES</h2>
<p>Marc van Zee - F093385<br><a href="mailto:M.vanZee@students.uu.nl">M.vanZee@students.uu.nl</a></p>
<p>Artificial Intelligence<br>Univerity of Utrecht</p><br>
<h2>PROCEDURES</h2>
<pre><font color="#5a5a5a">; Cellular Automaton - flow control in a decentralized network              28/05/2010</font><font color="#000000">
</font><font color="#5a5a5a">; by Marc van Zee / F093385</font><font color="#000000">
</font><font color="#5a5a5a">; M.vanZee@students.uu.nl</font><font color="#000000">
</font><font color="#5a5a5a">;</font><font color="#000000">
</font><font color="#5a5a5a">; Artifial Intelligence / University of Utrecht</font><font color="#000000">
</font><font color="#5a5a5a">;</font><font color="#000000">
</font><font color="#5a5a5a">; for a description, please see the information tab</font><font color="#000000">
</font><font color="#5a5a5a">;</font><font color="#000000">
</font><font color="#5a5a5a">; the code is very long, but i tried to make it even longer by using a lot of comments.</font><font color="#000000">
</font><font color="#5a5a5a">; i hope it helps.</font><font color="#000000">

</font><font color="#5a5a5a">; colors of the patches:</font><font color="#000000">
</font><font color="#5a5a5a">; [BLACK]   = background, nothing</font><font color="#000000">
</font><font color="#5a5a5a">; [86-89]   = moving particles</font><font color="#000000">
</font><font color="#5a5a5a">;   [86]    = up</font><font color="#000000">
</font><font color="#5a5a5a">;   [87]    = left</font><font color="#000000">
</font><font color="#5a5a5a">;   [88]    = down</font><font color="#000000">
</font><font color="#5a5a5a">;   [89]    = right</font><font color="#000000">
</font><font color="#5a5a5a">; [YELLOW]  = road that particles travel on</font><font color="#000000">
</font><font color="#5a5a5a">; [BROWN]   = wall protecting the roads</font><font color="#000000">
</font><font color="#5a5a5a">; [RED]     = crossing, intersection of roads</font><font color="#000000">
</font><font color="#5a5a5a">; [WHITE]   = crossing with a particle on it</font><font color="#000000">
</font><font color="#5a5a5a">; [MAGENTA] = obstacle</font><font color="#000000">
</font><font color="#5a5a5a">; [PINK]    = patch or connected patch has been hit by an obstacle</font><font color="#000000">

</font><font color="#007f69">patches-own</font><font color="#000000"> [
  greens4    greens                                          </font><font color="#5a5a5a">; colors of the neighbors</font><font color="#000000">
  browns4    browns                                          </font><font color="#5a5a5a">; {color}4 = [neighbors4]</font><font color="#000000">
  blacks4    blacks                                          </font><font color="#5a5a5a">; {color}  = [neighbors]</font><font color="#000000">
  reds
  magentas4
  pinks4
  
  from                                                       </font><font color="#5a5a5a">; &lt;road/crossing var&gt; boolean-list of incoming particles: [up right down left]</font><font color="#000000">
  extend?                                                    </font><font color="#5a5a5a">; &lt;wall var&gt;          extend? = true =&gt; two particles collide</font><font color="#000000">
  
  wait-for                                                   </font><font color="#5a5a5a">; &lt;crossing var&gt;      current delay of outgoing particles</font><font color="#000000">
  wait-value                                                 </font><font color="#5a5a5a">; &lt;crossing var&gt;      value to reset to when a particle enters</font><font color="#000000">
]

</font><font color="#007f69">to</font><font color="#000000"> setup
  </font><font color="#0000aa">ca</font><font color="#000000">
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> wait-value (</font><font color="#963700">50</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> population-density) ]                 </font><font color="#5a5a5a">; initialize all patches with the default wait-time</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> setup-random
  setup
  
  </font><font color="#0000aa">let</font><font color="#000000"> x </font><font color="#660096">min-pxcor</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> y </font><font color="#660096">min-pxcor</font><font color="#000000">
  
  </font><font color="#0000aa">while</font><font color="#000000"> [x </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">max-pxcor</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> y </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#660096">max-pycor</font><font color="#000000">] [
    </font><font color="#0000aa">set</font><font color="#000000"> x (x </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">)
    </font><font color="#0000aa">set</font><font color="#000000"> y (y </font><font color="#660096">+</font><font color="#000000"> </font><font color="#660096">random</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000">)
    
    create-road x y </font><font color="#660096">one-of</font><font color="#000000"> [</font><font color="#963700">&quot;horizontal&quot;</font><font color="#000000"> </font><font color="#963700">&quot;vertical&quot;</font><font color="#000000"> ] 
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> go-once
  go
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> go
  add-first-particle                                         </font><font color="#5a5a5a">; check if we add a particle when the roads are empty</font><font color="#000000">
  plot-all
  
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [ collect-neighbors ]                          </font><font color="#5a5a5a">; first collect all the states of the cells and put them in the variables</font><font color="#000000">
  
   </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [                                    </font><font color="#5a5a5a">;&lt;-------;-- update patches. this order makes sure all patches are synchronized.</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000"> [ update-background ] [            </font><font color="#5a5a5a">;-- see the Brains Brain simulation for more explanation.  </font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> [ update-walls ] [   
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> [ update-road ] [
      
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">85</font><font color="#000000">                              </font><font color="#5a5a5a">;&lt;-------;-- pcolor [86-89] represent the colors for the particles. every color maps</font><font color="#000000">
       </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">    [ update-particles ] [             </font><font color="#5a5a5a">;-- to the direction that it moves in:</font><font color="#000000">
                                                             </font><font color="#5a5a5a">;-- 86 = up, 87 = left, 88 = down, 89 = right</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">   [ update-crossings ] [
                                                         
    </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> ] [      </font><font color="#5a5a5a">;&lt;-------;-- when a particle is on a crossing, it will turn white. so when the particle</font><font color="#000000">
                                                             </font><font color="#5a5a5a">;-- is on the crossing, the crossing has to turn red again the next tick.</font><font color="#000000">
    </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000"> [
      </font><font color="#0000aa">ifelse</font><font color="#000000"> reds </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">     [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000"> ]               </font><font color="#5a5a5a">; when a particle is pink, it has been indirectly in contact with an obstacle and</font><font color="#000000">
                          [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]               </font><font color="#5a5a5a">; has to destroy itself. except when it is at a crossing, then it has to close the wall</font><font color="#000000">
   
    ] ] ] ] ] ] ] ] </font><font color="#5a5a5a">;&lt;--- ugly, no else-if in netlogo?</font><font color="#000000">
  </font><font color="#0000aa">tick</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> collect-neighbors                                         </font><font color="#5a5a5a">; collection of states. every kind of patch needs its own referents</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">
     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000">] </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> greens     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000">  </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> browns4    </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> greens4    </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">]
  ]
    
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> greens     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000">  </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> browns4    </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> pinks4     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> magentas4  </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">magenta</font><font color="#000000">]  
  ]
    
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> browns     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000">  </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> greens4    </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> pinks4     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> blacks     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000">  </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> reds       </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000">  </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]

    check-for-collision                                       </font><font color="#5a5a5a">; check if any particles have collided next to the wall</font><font color="#000000">
  ]
    
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000"> [ 
    </font><font color="#0000aa">set</font><font color="#000000"> reds </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000">  </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">] 
  ]
    
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> [ 
    </font><font color="#0000aa">set</font><font color="#000000"> magentas4 </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">magenta</font><font color="#000000">] 
  ]
    
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">85</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">) [
    </font><font color="#0000aa">set</font><font color="#000000"> magentas4 </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">magenta</font><font color="#000000">]
    </font><font color="#0000aa">set</font><font color="#000000"> pinks4     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000">]
  ]
  
  </font><font color="#0000aa">if</font><font color="#000000"> (</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">) [ 
    check-incoming-particles                                  </font><font color="#5a5a5a">; see if a road or a crossing needs to receive a particle next tick</font><font color="#000000">
  ]
</font><font color="#007f69">end</font><font color="#000000">
  
</font><font color="#007f69">to</font><font color="#000000"> check-for-collision                               </font><font color="#5a5a5a">;&lt;-------;-- extend the road if two particles cross in the same direction</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">86</font><font color="#000000">] </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">             </font><font color="#5a5a5a">;-- only one particle (86 or 87) will get a road right next to it</font><font color="#000000">
               </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">88</font><font color="#000000">] </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)    </font><font color="#5a5a5a">;-- this is to make sure the road will not be created double.</font><font color="#000000">
      </font><font color="#660096">or</font><font color="#000000"> (</font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">87</font><font color="#000000">] </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">
               </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">89</font><font color="#000000">] </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [  
          </font><font color="#0000aa">set</font><font color="#000000"> extend? </font><font color="#963700">true</font><font color="#000000"> ] [ </font><font color="#0000aa">set</font><font color="#000000"> extend? </font><font color="#963700">false</font><font color="#000000"> ]
</font><font color="#007f69">end</font><font color="#000000">
  
</font><font color="#007f69">to</font><font color="#000000"> check-incoming-particles
  </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [(</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">85</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">)  
         </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [                             </font><font color="#5a5a5a">; create a boolean list with the incoming particles</font><font color="#000000">
    </font><font color="#0000aa">set</font><font color="#000000"> from list-particles-here
  ] [ </font><font color="#0000aa">set</font><font color="#000000"> from [</font><font color="#963700">false</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000">] ]                    </font><font color="#5a5a5a">; no incoming particles =&gt; false list</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-background                                          </font><font color="#5a5a5a">; road building rules for the background</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> greens4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">                                          </font><font color="#5a5a5a">; i have not commented on all the rules of the patches, because i</font><font color="#000000">
      </font><font color="#660096">or</font><font color="#000000"> greens4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> [                                        </font><font color="#5a5a5a">; believe they are rather trivial. most of the rules are there to</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> browns4 </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> [                                     </font><font color="#5a5a5a">; make the roads connect nicely and to process the collision.</font><font color="#000000">
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> 
    ] [ 
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> 
    ]
  ] [ 
    </font><font color="#0000aa">if</font><font color="#000000"> (browns4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> browns4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
       </font><font color="#660096">and</font><font color="#000000"> (greens  </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> greens  </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">) [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ] 
  ]
  </font><font color="#0000aa">if</font><font color="#000000"> browns4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> greens4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-road
  </font><font color="#0000aa">if</font><font color="#000000"> greens </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]
  </font><font color="#0000aa">if</font><font color="#000000"> pinks4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000"> ]
  </font><font color="#0000aa">if</font><font color="#000000"> magentas4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> greens4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000"> ]
                     
  </font><font color="#0000aa">if</font><font color="#000000"> particle-here [                                          </font><font color="#5a5a5a">; become particle or a crossing when necessary</font><font color="#000000">
    </font><font color="#0000aa">ifelse</font><font color="#000000"> on-crossing [
      become-crossing
    ] [
      become-particle
    ]
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-walls
  </font><font color="#0000aa">if</font><font color="#000000"> (browns </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">4</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> browns </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">5</font><font color="#000000">)
     </font><font color="#660096">and</font><font color="#000000"> greens4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> ]
  
  </font><font color="#0000aa">if</font><font color="#000000"> extend? </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> 
     </font><font color="#660096">and</font><font color="#000000"> reds </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> 
     </font><font color="#660096">and</font><font color="#000000"> blacks </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">  [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> ]
     
  </font><font color="#0000aa">if</font><font color="#000000"> pinks4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> 
     </font><font color="#660096">and</font><font color="#000000"> reds </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> 
     </font><font color="#660096">and</font><font color="#000000"> greens4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">black</font><font color="#000000"> ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-particles
  </font><font color="#0000aa">ifelse</font><font color="#000000"> magentas4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
    </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000">
  ] [
    </font><font color="#0000aa">ifelse</font><font color="#000000"> pinks4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ 
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000"> 
    ] [ 
      </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">                                       </font><font color="#5a5a5a">; particles become green (the road) again, which makes them move</font><font color="#000000">
    ] 
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> update-crossings                                          </font><font color="#5a5a5a">; crossings are the heart of the dynamic behavior</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> reds </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">      [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> ]                      </font><font color="#5a5a5a">; see 'information' tab for an explanation</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> magentas4 </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">pink</font><font color="#000000">]
      
  </font><font color="#0000aa">ifelse</font><font color="#000000"> wait-for </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
    </font><font color="#0000aa">ifelse</font><font color="#000000"> particle-here [
      become-crossing-with-particle
    ] [
      decrease-wait-value
    ]
  ] [ 
    </font><font color="#0000aa">if</font><font color="#000000"> wait-for </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ 
      </font><font color="#0000aa">set</font><font color="#000000"> wait-for (wait-for </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)
      </font><font color="#0000aa">ifelse</font><font color="#000000"> particle-here [ 
        </font><font color="#0000aa">set</font><font color="#000000"> wait-value (wait-value </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#963700">50</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> population-density))            </font><font color="#5a5a5a">; sensitivity value can be changed by use</font><font color="#000000">
      ] [
        decrease-wait-value
      ] 
    ] 
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#5a5a5a">; ##########################################</font><font color="#000000">
</font><font color="#5a5a5a">; ########### GUI PROCEDURES ###############</font><font color="#000000">
</font><font color="#5a5a5a">; ##########################################</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> draw                                                      </font><font color="#5a5a5a">; draw a piece of a road. the algorithm will finish it automatically</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">mouse-down?</font><font color="#000000"> [
    create-road </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">mouse-ycor</font><font color="#000000"> draw-direction
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> add-particle                                              </font><font color="#5a5a5a">; add a particle one a free place, if available</font><font color="#000000">
  </font><font color="#0000aa">let</font><font color="#000000"> free_patches </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> 
      [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> </font><font color="#660096">neighbors4</font><font color="#000000">]
  
  </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">any?</font><font color="#000000"> free_patches [
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> free_patches [
      </font><font color="#0000aa">if</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patch-at</font><font color="#000000">  </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> [</font><font color="#963700">86</font><font color="#000000"> </font><font color="#963700">88</font><font color="#000000">] ]
      </font><font color="#0000aa">if</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patch-at</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">  </font><font color="#963700">0</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">one-of</font><font color="#000000"> [</font><font color="#963700">87</font><font color="#000000"> </font><font color="#963700">89</font><font color="#000000">] ]
    ]
  ] [
    </font><font color="#0000aa">print</font><font color="#000000"> </font><font color="#963700">&quot;ERROR: no road available to add particle!&quot;</font><font color="#000000">
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> draw-obstacle                                             </font><font color="#5a5a5a">; draw a square obstacle with a radius specified by the user</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">mouse-down?</font><font color="#000000"> [ 
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> </font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">mouse-ycor</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">magenta</font><font color="#000000"> ] 
    </font><font color="#0000aa">let</font><font color="#000000"> o-size (obstacle-size </font><font color="#660096">/</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000">)
    </font><font color="#0000aa">let</font><font color="#000000"> i </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> o-size
    
    </font><font color="#0000aa">while</font><font color="#000000"> [i </font><font color="#660096">&lt;</font><font color="#000000"> o-size] [
      </font><font color="#0000aa">let</font><font color="#000000"> j </font><font color="#963700">-1</font><font color="#000000"> </font><font color="#660096">*</font><font color="#000000"> o-size
      </font><font color="#0000aa">while</font><font color="#000000"> [j </font><font color="#660096">&lt;</font><font color="#000000"> o-size] [
        </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (</font><font color="#660096">mouse-xcor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> i) (</font><font color="#660096">mouse-ycor</font><font color="#000000"> </font><font color="#660096">+</font><font color="#000000"> j) [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">magenta</font><font color="#000000"> ] 
        </font><font color="#0000aa">set</font><font color="#000000"> j (j </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)
      ]
      </font><font color="#0000aa">set</font><font color="#000000"> i (i </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">)
    ]
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> add-first-particle                                        </font><font color="#5a5a5a">; keep adding new particles if the simulation dies out,</font><font color="#000000">
  </font><font color="#0000aa">if</font><font color="#000000"> add-particle-when-empty </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000">                      </font><font color="#5a5a5a">; only if the user has chosen for it of course.</font><font color="#000000">
     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">85</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">] </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> 
     </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000">] </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [ add-particle ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> plot-all                                                  </font><font color="#5a5a5a">; plot three graphs:</font><font color="#000000">
  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;particles&quot;</font><font color="#000000">                           </font><font color="#5a5a5a">; [1] number of particles</font><font color="#000000">
  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">85</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">90</font><font color="#000000">]
  
  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;crossings&quot;</font><font color="#000000">                           </font><font color="#5a5a5a">; [2] number of crossings</font><font color="#000000">
  </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]
  
  </font><font color="#0000aa">set-current-plot-pen</font><font color="#000000"> </font><font color="#963700">&quot;average-waiting-time&quot;</font><font color="#000000">                </font><font color="#5a5a5a">; [3] avarage wait-value of the crossings</font><font color="#000000">
  </font><font color="#0000aa">ifelse</font><font color="#000000"> </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">] </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> [
    </font><font color="#0000aa">plot</font><font color="#000000"> (</font><font color="#660096">sum</font><font color="#000000"> [wait-value] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]) </font><font color="#660096">/</font><font color="#000000"> 
              </font><font color="#660096">count</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> </font><font color="#660096">with</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000">]
  ] [ </font><font color="#0000aa">plot</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> save 
  </font><font color="#0000aa">let</font><font color="#000000"> file </font><font color="#660096">user-new-file</font><font color="#000000">

  </font><font color="#0000aa">if</font><font color="#000000"> ( file </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> ) [
    </font><font color="#0000aa">file-open</font><font color="#000000"> file
    
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patches</font><font color="#000000"> [
      </font><font color="#0000aa">file-write</font><font color="#000000"> </font><font color="#660096">pxcor</font><font color="#000000">
      </font><font color="#0000aa">file-write</font><font color="#000000"> </font><font color="#660096">pycor</font><font color="#000000">
      </font><font color="#0000aa">file-write</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000">
    ]
    </font><font color="#0000aa">file-close</font><font color="#000000">
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> load
  </font><font color="#0000aa">let</font><font color="#000000"> file </font><font color="#660096">user-file</font><font color="#000000">

  </font><font color="#0000aa">if</font><font color="#000000"> ( file </font><font color="#660096">!=</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> ) [
    </font><font color="#0000aa">let</font><font color="#000000"> patch-data []
    </font><font color="#0000aa">file-open</font><font color="#000000"> file

    </font><font color="#0000aa">while</font><font color="#000000"> [ </font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">file-at-end?</font><font color="#000000"> ]
      [ </font><font color="#0000aa">set</font><font color="#000000"> patch-data </font><font color="#660096">sentence</font><font color="#000000"> patch-data (</font><font color="#660096">list</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#660096">file-read</font><font color="#000000"> </font><font color="#660096">file-read</font><font color="#000000"> </font><font color="#660096">file-read</font><font color="#000000">)) ]

    </font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;File loading complete!&quot;</font><font color="#000000">
    </font><font color="#0000aa">file-close</font><font color="#000000">
    
    process-file patch-data
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> preset [num]
  </font><font color="#0000aa">let</font><font color="#000000"> file </font><font color="#660096">word</font><font color="#000000"> </font><font color="#963700">&quot;presets/preset&quot;</font><font color="#000000"> num
  
  </font><font color="#0000aa">ifelse</font><font color="#000000"> ( </font><font color="#660096">file-exists?</font><font color="#000000"> file ) [
    </font><font color="#0000aa">let</font><font color="#000000"> patch-data []
    </font><font color="#0000aa">file-open</font><font color="#000000"> file

    </font><font color="#0000aa">while</font><font color="#000000"> [ </font><font color="#660096">not</font><font color="#000000"> </font><font color="#660096">file-at-end?</font><font color="#000000"> ] [
      </font><font color="#0000aa">set</font><font color="#000000"> patch-data </font><font color="#660096">sentence</font><font color="#000000"> patch-data (</font><font color="#660096">list</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> </font><font color="#660096">file-read</font><font color="#000000"> </font><font color="#660096">file-read</font><font color="#000000"> </font><font color="#660096">file-read</font><font color="#000000">))
    ]

    </font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;File loading complete!&quot;</font><font color="#000000">
    </font><font color="#0000aa">file-close</font><font color="#000000">
    
    process-file patch-data
  ] [ 
    </font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;There is no File IO Patch Data.txt file in current directory!&quot;</font><font color="#000000"> 
  ]
</font><font color="#007f69">end</font><font color="#000000">
    

</font><font color="#5a5a5a">; ##########################################</font><font color="#000000">
</font><font color="#5a5a5a">; ########### SHORT PROCEDURES #############</font><font color="#000000">
</font><font color="#5a5a5a">; ##########################################                 ; procedures to make the code more readable</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> process-file [file-list]
  setup
  </font><font color="#0000aa">ifelse</font><font color="#000000"> ( </font><font color="#660096">is-list?</font><font color="#000000"> file-list ) [ 
    </font><font color="#0000aa">foreach</font><font color="#000000"> file-list [ </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> </font><font color="#660096">first</font><font color="#000000"> ? </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> ? [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">last</font><font color="#000000"> ? ] ] 
  ] [ 
    </font><font color="#0000aa">user-message</font><font color="#000000"> </font><font color="#963700">&quot;File doesnt contains any data!&quot;</font><font color="#000000"> 
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> on-crossing 
  </font><font color="#0000aa">report</font><font color="#000000"> (browns4 </font><font color="#660096">&lt;</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> </font><font color="#660096">and</font><font color="#000000"> magentas4 </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000">)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> particle-here
  </font><font color="#0000aa">report</font><font color="#000000"> from </font><font color="#660096">!=</font><font color="#000000"> [</font><font color="#963700">false</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000"> </font><font color="#963700">false</font><font color="#000000">]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to-report</font><font color="#000000"> list-particles-here
  </font><font color="#0000aa">report</font><font color="#000000"> (</font><font color="#660096">list</font><font color="#000000"> [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">89</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patch-at</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">  </font><font color="#963700">0</font><font color="#000000"> 
               [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">88</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patch-at</font><font color="#000000">  </font><font color="#963700">0</font><font color="#000000">  </font><font color="#963700">1</font><font color="#000000">
               [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">87</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patch-at</font><font color="#000000">  </font><font color="#963700">1</font><font color="#000000">  </font><font color="#963700">0</font><font color="#000000">
               [</font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">86</font><font color="#000000"> </font><font color="#660096">or</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">] </font><font color="#660096">of</font><font color="#000000"> </font><font color="#660096">patch-at</font><font color="#000000">  </font><font color="#963700">0</font><font color="#000000"> </font><font color="#963700">-1</font><font color="#000000">)
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> create-road [x y direction]
  </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> x y [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">green</font><font color="#000000"> ]
  </font><font color="#0000aa">ifelse</font><font color="#000000"> direction </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">&quot;horizontal&quot;</font><font color="#000000"> [
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> x (y </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> x (y </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]
  ] [
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (x </font><font color="#660096">+</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) y [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]
    </font><font color="#0000aa">ask</font><font color="#000000"> </font><font color="#660096">patch</font><font color="#000000"> (x </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) y [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">brown</font><font color="#000000"> ]
  ]
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> become-crossing
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">red</font><font color="#000000"> </font><font color="#0000aa">set</font><font color="#000000"> wait-for wait-value
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> become-particle
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">0</font><font color="#000000"> from </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">89</font><font color="#000000"> ] 
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000"> from </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">88</font><font color="#000000"> ] 
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">2</font><font color="#000000"> from </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">87</font><font color="#000000"> ] 
  </font><font color="#0000aa">if</font><font color="#000000"> </font><font color="#660096">item</font><font color="#000000"> </font><font color="#963700">3</font><font color="#000000"> from </font><font color="#660096">=</font><font color="#000000"> </font><font color="#963700">true</font><font color="#000000"> [ </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">86</font><font color="#000000"> ] 
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> become-crossing-with-particle
  </font><font color="#0000aa">set</font><font color="#000000"> wait-for wait-value
  </font><font color="#0000aa">set</font><font color="#000000"> wait-value (wait-value </font><font color="#660096">+</font><font color="#000000"> (</font><font color="#963700">50</font><font color="#000000"> </font><font color="#660096">-</font><font color="#000000"> population-density))
  </font><font color="#0000aa">set</font><font color="#000000"> </font><font color="#660096">pcolor</font><font color="#000000"> </font><font color="#963700">white</font><font color="#000000">
</font><font color="#007f69">end</font><font color="#000000">

</font><font color="#007f69">to</font><font color="#000000"> decrease-wait-value
  </font><font color="#0000aa">if</font><font color="#000000"> (wait-value </font><font color="#660096">&gt;</font><font color="#000000"> </font><font color="#963700">10</font><font color="#000000">) [ 
    </font><font color="#0000aa">set</font><font color="#000000"> wait-value (wait-value </font><font color="#660096">-</font><font color="#000000"> </font><font color="#963700">1</font><font color="#000000">) 
  ]
</font><font color="#007f69">end</font><font color="#000000">
</font>
</pre>

</body>
</html>
